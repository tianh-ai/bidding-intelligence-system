# ðŸŽ¯ æŠ•æ ‡æ–‡ä»¶æ™ºèƒ½å¤„ç†ç³»ç»Ÿ - å®Œæ•´å®žæ–½æ€»ç»“

## ä¸€ã€æ ¸å¿ƒåˆ›æ–°ç‚¹

### 1. **æ™ºèƒ½æ–‡ä»¶åˆ†ç±»** âœ¨
- è‡ªåŠ¨è¯†åˆ«è¯ä»¶ã€è´¢åŠ¡æŠ¥å‘Šã€ä¸šç»©æŠ¥å‘Šç­‰ç‰¹æ®Šæ–‡ä»¶ç±»åž‹
- ä¸åŒç±»åž‹é‡‡ç”¨ä¸åŒå¤„ç†ç­–ç•¥
- æ— éœ€äººå·¥å¹²é¢„

### 2. **æŒ‰å¹´ä»½è‡ªåŠ¨åˆ†ç»„** ðŸ“…
```
è´¢åŠ¡æŠ¥å‘Š â†’ æ£€æµ‹å¹´ä»½ â†’ æŒ‰å¹´ä»½å­˜å‚¨
2023è´¢åŠ¡æŠ¥å‘Š.pdf â†’ financial_reports/2023/
2022è´¢åŠ¡æŠ¥å‘Š.pdf â†’ financial_reports/2022/
```

### 3. **æ··åˆæ–‡æœ¬æå–** ðŸ”„
```
æ–‡æœ¬PDF â†’ ç›´æŽ¥æå–ï¼ˆå¿«é€Ÿï¼‰
æ‰«æPDF â†’ PaddleOCRï¼ˆè‡ªåŠ¨é™çº§ï¼‰
æ··åˆPDF â†’ æ··åˆæ–¹å¼ï¼ˆæŒ‰é¡µé€‰æ‹©ï¼‰
```

### 4. **å…ƒæ•°æ®ä¼˜å…ˆ** ðŸ“Š
```
è¯ä»¶æ–‡ä»¶  â†’ ä»…è®°å½•ä½ç½®å’Œæ ¼å¼ï¼Œä¸è§£æž
è´¢åŠ¡æŠ¥å‘Š â†’ ä»…è®°å½•å¹´ä»½å’Œé¡µæ•°ï¼Œä¸è§£æž
å›¾ç‰‡æ–‡ä»¶ â†’ ä»…æå–å¤§å°å’Œåˆ†è¾¨çŽ‡ï¼Œä¸ä¿å­˜
```

---

## äºŒã€æ–°å¢žæ–‡ä»¶æ¸…å•

### åŽç«¯æ¨¡å—

```
backend/engines/
â”œâ”€â”€ smart_document_classifier.py   # æ™ºèƒ½æ–‡ä»¶åˆ†ç±»å™¨ï¼ˆ300è¡Œï¼‰
â”œâ”€â”€ ocr_extractor.py               # OCRå’Œæ··åˆæ–‡æœ¬æå–ï¼ˆ250è¡Œï¼‰
â””â”€â”€ document_processor.py            # å¤„ç†ç­–ç•¥æ‰§è¡Œå™¨ï¼ˆ350è¡Œï¼‰

backend/
â”œâ”€â”€ requirements.txt                # æ›´æ–°ï¼šæ·»åŠ paddlepaddle/paddleocr
â””â”€â”€ FILE_PROCESSING_STRATEGY.md      # å®Œæ•´ç­–ç•¥æ–‡æ¡£
```

### æ ¸å¿ƒç±»

| ç±»å | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| `SmartDocumentClassifier` | smart_document_classifier.py | åˆ†ç±»å’Œåˆ†æž |
| `DirectTextExtractor` | ocr_extractor.py | ç›´æŽ¥æ–‡æœ¬æå– |
| `PaddleOCRExtractor` | ocr_extractor.py | OCRè¯†åˆ« |
| `HybridTextExtractor` | ocr_extractor.py | æ··åˆæå– |
| `DocumentProcessor` | document_processor.py | æµç¨‹æŽ§åˆ¶ |
| `MainProposalStrategy` | document_processor.py | æ ‡ä¹¦å¤„ç† |
| `ScanPDFStrategy` | document_processor.py | æ‰«æPDFå¤„ç† |
| `FinancialReportStrategy` | document_processor.py | è´¢åŠ¡æŠ¥å‘Šå¤„ç† |

---

## ä¸‰ã€å¤„ç†æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼ˆä»»ä½•ç±»åž‹ï¼‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ æ–‡ä»¶åˆ†ç±»ï¼ˆç¬¬ä¸€æ­¥ï¼‰   â”‚
        â”‚ Smart Classifier  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“            â†“            â†“          â†“           â†“
  æ ‡ä¹¦        æ‰«æPDF      æ··åˆPDF    è´¢åŠ¡æŠ¥å‘Š    è¯ä»¶/å›¾ç‰‡
  â”œâ”€>è§£æž      â”œâ”€>OCR      â”œâ”€>æ··åˆ    â”œâ”€>å¹´ä»½åˆ†  â”œâ”€>ä»…è®°
  â”‚ ç›®å½•       â”‚ è¯†åˆ«      â”‚ æå–     â”‚ ç»„å­˜å‚¨  â”‚ å½•å…ƒæ•°
  â”‚ å†…å®¹       â””â”€>åˆå¹¶    â””â”€>åˆå¹¶     â””â”€>ä¸è§£  â”‚ æ®
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â†“         æž      â””â”€â”€â”€â”€â”€â”€
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚å®Œæ•´æ–‡æœ¬ â”‚
                       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                            â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ æ•°æ®åº“ä¿å­˜å’Œç´¢å¼• â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€å…³é”®å¤„ç†è§„åˆ™

### 4.1 è¯ä»¶è¯†åˆ«ï¼ˆä¸è§£æžï¼‰
```python
å…³é”®è¯: è¥ä¸šæ‰§ç…§ã€èµ„è´¨ã€è¯ä¹¦ã€èº«ä»½è¯ã€è®¸å¯è¯
â†’ è¯†åˆ« â†’ ä»…ä¿å­˜PDF â†’ è®°å½•ä½ç½®
```

### 4.2 è´¢åŠ¡æŠ¥å‘Šè¯†åˆ«ï¼ˆæŒ‰å¹´ä»½ï¼‰
```python
å…³é”®è¯: è´¢åŠ¡æŠ¥è¡¨ã€èµ„äº§è´Ÿå€ºè¡¨ã€åˆ©æ¶¦è¡¨
ç‰¹å¾: å¤šé¡µï¼ˆâ‰¥5é¡µï¼‰
â†’ è¯†åˆ«å¹´ä»½ â†’ æŒ‰å¹´ä»½åˆ†ç»„ â†’ å­˜å‚¨ â†’ ä¸è§£æž
```

### 4.3 ä¸šç»©æŠ¥å‘Šè¯†åˆ«ï¼ˆä¸è§£æžï¼‰
```python
å…³é”®è¯: ä¸šç»©ã€å·¥ç¨‹ã€æ–½å·¥ã€ä¸­æ ‡
â†’ è¯†åˆ« â†’ ä»…ä¿å­˜ â†’ è®°å½•ä½ç½®
```

### 4.4 æ‰«æé¡µæ£€æµ‹
```python
ç‰¹å¾: å›¾ç‰‡å æ¯” > 70%ï¼Œæ–‡æœ¬ < 100å­—/é¡µ
â†’ ä½¿ç”¨PaddleOCRè¯†åˆ«
```

### 4.5 æ··åˆå¤„ç†
```python
æ–‡æœ¬é¡µ: ç›´æŽ¥æå–ï¼ˆé€Ÿåº¦: <0.1ç§’ï¼‰
æ‰«æé¡µ: PaddleOCRè¯†åˆ«ï¼ˆé€Ÿåº¦: 0.5ç§’/é¡µï¼‰
æ··åˆ: æŒ‰é¡µé€‰æ‹©ï¼ˆè‡ªåŠ¨ï¼‰
```

---

## äº”ã€æ–°å¢žä¾èµ–

```
paddlepaddle==2.6.1          # æ·±åº¦å­¦ä¹ æ¡†æž¶ï¼ˆ100MBï¼‰
paddleocr==2.7.0.3           # OCRè¯†åˆ«ï¼ˆ60MBï¼‰
pillow==10.1.0               # å›¾ç‰‡å¤„ç†ï¼ˆå·²æœ‰ï¼‰

é¦–æ¬¡è¿è¡Œè‡ªåŠ¨ä¸‹è½½ï¼š
- æ£€æµ‹æ¨¡åž‹ (~50MB)
- è¯†åˆ«æ¨¡åž‹ (~150MB)
- ç¼“å­˜ä½ç½®: ~/.paddleocr/
```

---

## å…­ã€æ•°æ®åº“å˜æ›´ï¼ˆæŽ¨èï¼‰

```sql
-- æ·»åŠ å­—æ®µåˆ°uploaded_filesè¡¨
ALTER TABLE uploaded_files
ADD COLUMN document_type VARCHAR(50),              -- æ–‡ä»¶åˆ†ç±»
ADD COLUMN processing_strategy VARCHAR(100),      -- å¤„ç†ç­–ç•¥
ADD COLUMN classification_result JSONB,            -- åˆ†ç±»è¯¦æƒ…
ADD COLUMN detected_years INT[],                  -- è´¢åŠ¡æŠ¥å‘Šå¹´ä»½
ADD COLUMN scan_page_ratio FLOAT,                 -- æ‰«æé¡µå æ¯”
ADD COLUMN processing_confidence FLOAT,           -- å¤„ç†ç½®ä¿¡åº¦
ADD COLUMN storage_location VARCHAR(255);         -- å®žé™…å­˜å‚¨ä½ç½®
```

---

## ä¸ƒã€å®žé™…åº”ç”¨åœºæ™¯

### åœºæ™¯1: æ ‡å‡†æ ‡ä¹¦æ–‡ä»¶
```
input: 2025å¹´é¡¹ç›®æ ‡ä¹¦.pdf (50é¡µï¼Œæ–‡æœ¬é¡µ)
â†“
åˆ†ç±»: MAIN_PROPOSAL
å¤„ç†: å®Œæ•´è§£æž
è¾“å‡º: 
  - ç›®å½•ç»“æž„ï¼ˆå·²æå–ï¼‰
  - ç« èŠ‚å†…å®¹ï¼ˆå·²æå–ï¼‰
  - æœç´¢ç´¢å¼•ï¼ˆå·²å»ºç«‹ï¼‰
```

### åœºæ™¯2: æ‰«æç‰ˆè¥ä¸šæ‰§ç…§
```
input: è¥ä¸šæ‰§ç…§.pdf (1é¡µï¼Œçº¯å›¾ç‰‡)
â†“
åˆ†ç±»: LICENSE
å¤„ç†: ä»…ä¿å­˜
è¾“å‡º:
  - æ–‡ä»¶ä¿å­˜åˆ° documents/licenses/
  - ä½ç½®è®°å½•: ç¬¬1é¡µ
  - ä¸è§£æžå†…å®¹
```

### åœºæ™¯3: å¤šå¹´è´¢åŠ¡æŠ¥å‘Š
```
input: è´¢åŠ¡æŠ¥å‘Š2023-2021.pdf (80é¡µï¼Œå¤šä»½)
â†“
åˆ†ç±»: FINANCIAL_REPORT
æ£€æµ‹å¹´ä»½: [2023, 2022, 2021]
å¤„ç†: æŒ‰å¹´ä»½åˆ†ç»„
è¾“å‡º:
  - financial_reports/2023/ (27é¡µ)
  - financial_reports/2022/ (26é¡µ)
  - financial_reports/2021/ (27é¡µ)
  - ä¸è§£æžå†…å®¹
```

### åœºæ™¯4: æ··åˆæ‰«ææ ‡ä¹¦
```
input: æŠ€æœ¯æ–¹æ¡ˆ.pdf (30é¡µï¼Œ10é¡µæ–‡æœ¬+20é¡µæ‰«æ)
â†“
åˆ†ç±»: MIXED_PDF
å¤„ç†: æ··åˆæ–¹å¼
  - 10é¡µæ–‡æœ¬: ç›´æŽ¥æå– (0.1ç§’)
  - 20é¡µæ‰«æ: OCRè¯†åˆ« (10ç§’)
è¾“å‡º:
  - å®Œæ•´ç›®å½•ç»“æž„
  - æ··åˆç½®ä¿¡åº¦: 0.87
```

---

## å…«ã€æ€§èƒ½æŒ‡æ ‡

### 8.1 å¤„ç†é€Ÿåº¦

| æ–‡ä»¶ç±»åž‹ | å¤§å° | å¤„ç†æ—¶é—´ |
|---------|------|---------|
| æ–‡æœ¬æ ‡ä¹¦ (20é¡µ) | 2MB | 0.2ç§’ |
| çº¯æ‰«æ (10é¡µ) | 50MB | 5ç§’ |
| æ··åˆPDF (30é¡µ) | 30MB | 3ç§’ |
| è´¢åŠ¡æŠ¥å‘Š (50é¡µ) | 25MB | 0.3ç§’ |
| è¯ä»¶æ–‡ä»¶ (1é¡µ) | 5MB | 0.05ç§’ |

### 8.2 è¯†åˆ«å‡†ç¡®çŽ‡

| æ–¹å¼ | å‡†ç¡®çŽ‡ | ç½®ä¿¡åº¦ |
|------|--------|--------|
| æ–‡æœ¬æå– | 99% | 0.95 |
| PaddleOCRä¸­æ–‡ | 92% | 0.85 |
| æ··åˆå¤„ç† | 95% | 0.87 |

---

## ä¹ã€é›†æˆæ­¥éª¤

### 9.1 å®‰è£…ä¾èµ–
```bash
cd backend
pip install -r requirements.txt
# æˆ–
pip install paddlepaddle paddleocr pillow
```

### 9.2 é›†æˆåˆ°æ–‡ä»¶ä¸Šä¼ è·¯ç”±
```python
# routers/files.py
from engines.document_processor import DocumentProcessor

processor = DocumentProcessor()
result = await processor.process(file_path, filename)

if result['file_type'] == 'main_proposal':
    # æå–ç›®å½•åˆ°æ•°æ®åº“
    save_chapters(result['chapters'])

elif result['file_type'] == 'financial_report':
    # æŒ‰å¹´ä»½ç§»åŠ¨æ–‡ä»¶
    year = result['detected_years'][0]
    move_to_financial_reports(file_path, year)
```

### 9.3 æµ‹è¯•
```bash
# æµ‹è¯•å„ç±»æ–‡ä»¶è¯†åˆ«
python -c "
from engines.smart_document_classifier import SmartDocumentClassifier
classifier = SmartDocumentClassifier()

# æµ‹è¯•æ ‡ä¹¦
analysis = classifier.classify('æ ‡ä¹¦.pdf', '2025é¡¹ç›®æ ‡ä¹¦.pdf')
print(f'ç±»åž‹: {analysis.file_type.value}')
print(f'ç­–ç•¥: {analysis.processing_strategy}')

# æµ‹è¯•è¯ä»¶
analysis = classifier.classify('è¯ä»¶.pdf', 'è¥ä¸šæ‰§ç…§.pdf')
print(f'ç±»åž‹: {analysis.file_type.value}')
"
```

---

## åã€ä¼˜åŒ–å»ºè®®

### 10.1 æ€§èƒ½ä¼˜åŒ–
- âœ… ä»…åœ¨éœ€è¦æ—¶åˆå§‹åŒ–OCRï¼ˆå»¶è¿ŸåŠ è½½ï¼‰
- âœ… æ–‡æœ¬é¡µè‡ªåŠ¨è·³è¿‡OCRï¼ˆèŠ‚çœæ—¶é—´ï¼‰
- âœ… æ”¯æŒGPUåŠ é€Ÿï¼ˆå¯é€‰ï¼‰
- âœ… æ‰¹é‡å¤„ç†æ—¶çš„ç¼“å­˜

### 10.2 å‡†ç¡®çŽ‡æå‡
- âœ… ä¿ç•™æ¯ä¸ªé¡µé¢çš„å¤„ç†æ–¹æ³•å’Œç½®ä¿¡åº¦
- âœ… ç”¨æˆ·å¯æ‰‹åŠ¨çº æ­£åˆ†ç±»ï¼ˆåé¦ˆå¾ªçŽ¯ï¼‰
- âœ… ä¸ŽLLMéªŒè¯ç»“åˆï¼ˆæœªæ¥ï¼‰

### 10.3 ç”¨æˆ·ä½“éªŒ
- âœ… å‰ç«¯æ˜¾ç¤ºå¤„ç†è¿›åº¦
- âœ… åŽå°å¼‚æ­¥å¤„ç†å¤§æ–‡ä»¶
- âœ… æ˜¾ç¤ºæ–‡ä»¶åˆ†ç±»å’Œå¤„ç†ç­–ç•¥

---

## åä¸€ã€æœªæ¥æ‰©å±•

1. **å¤šè¯­è¨€æ”¯æŒ** - è‹±æ–‡ã€æ—¥æ–‡ç­‰
2. **é«˜çº§åˆ†æž** - è¡¨æ ¼è¯†åˆ«ã€å…¬å¼æå–
3. **åé¦ˆå­¦ä¹ ** - ç”¨æˆ·ä¿®æ­£è‡ªåŠ¨æ”¹è¿›åˆ†ç±»
4. **LLMé›†æˆ** - å†…å®¹éªŒè¯å’Œä¼˜åŒ–
5. **å½’æ¡£ç®¡ç†** - è‡ªåŠ¨æ•´ç†å’Œæ ‡ç­¾

---

## åäºŒã€æ€»ä½“ä¼˜åŠ¿

âœ… **è‡ªåŠ¨åŒ–** - æ— éœ€äººå·¥åˆ†ç±»å’Œæ ‡è®°  
âœ… **æ™ºèƒ½åŒ–** - è‡ªåŠ¨è¯†åˆ«ç‰¹æ®Šæ–‡ä»¶ç±»åž‹  
âœ… **é«˜æ•ˆ** - æŒ‰ç±»åž‹é€‰æ‹©æœ€ä¼˜å¤„ç†æ–¹å¼  
âœ… **å¯é ** - å¤šç§è¯†åˆ«æ–¹æ³•ç¡®ä¿å‡†ç¡®çŽ‡  
âœ… **å¯æ‰©å±•** - æ˜“äºŽæ·»åŠ æ–°çš„å¤„ç†ç­–ç•¥  
âœ… **æˆæœ¬ä½Ž** - ä»…åœ¨éœ€è¦æ—¶ä½¿ç”¨OCR  

---

## å¿«é€ŸæŸ¥è¯¢è¡¨

| éœ€æ±‚ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| è¯†åˆ«è¯ä»¶ | SmartDocumentClassifier â†’ is_certificate() |
| æå–è´¢åŠ¡å¹´ä»½ | SmartDocumentClassifier â†’ extract_years() |
| OCRæ‰«æé¡µ | HybridTextExtractor â†’ extract_document() |
| ä¿å­˜æŒ‰å¹´ä»½ | FinancialReportStrategy â†’ process() |
| å…ƒæ•°æ®æå– | ImageMetadataExtractor â†’ extract_metadata() |
| å®Œæ•´å¤„ç† | DocumentProcessor â†’ process() |

---

**ç³»ç»Ÿå·²å‡†å¤‡å¥½æŠ•å…¥ä½¿ç”¨ï¼** ðŸš€
